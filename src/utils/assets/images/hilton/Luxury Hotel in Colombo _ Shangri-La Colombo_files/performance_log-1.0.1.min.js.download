var hasSendOther=false,hasSendLoad=false,resourceCache=[];function send(d,type){if(!d||!type){return}var img=new Image();img.onerror=null;img.onload=null;img.src='https://www.shangri-la.com/felog/logs/'+type+'?d='+encodeURIComponent(JSON.stringify(d))}function isLoad(pTiming){var start=pTiming.navigationStart||pTiming.fetchStart;return pTiming.loadEventEnd-start>0}function performanceLog(){var pTiming=performance.timing;if(isLoad(pTiming)){hasSendLoad=true}try{if(pageName){if(pTiming.toJSON){delete pTiming.toJSON}send({page:pageName,data:pTiming,loadOnly:hasSendOther},'performance')}}catch(e){send('window.performance error','error')}try{var resource=window.performance.getEntriesByType("resource"),result=[];for(var i=0;i<resource.length;i++){var item=resource[i];if(item.initiatorType=='script'&&item.name.indexOf('assets.adobedtm.com')!=-1){var url=new URL(item.name),path=url.pathname.split('/'),name=path.length?path[path.length-1]:item.name;var val=name.replace(/-[^-]+-staging.js/,"");if(resourceCache.indexOf(val)==-1){result.push({name:val,duration:parseInt(item.duration)});resourceCache.push(val)}}}if(result.length){send(result,'resource')}}catch(e){send('window.performance.getEntriesByType error','error')}}function judgeLoad(){if(!isLoad(performance.timing)){setTimeout(function(){judgeLoad()},200);return}else{performanceLog()}}window.onload=function(){if(hasSendLoad){return}if(window.performance){judgeLoad()}else{send('window.performance undefined','error')}};document.ready=function(callback){if(document.addEventListener){document.addEventListener('DOMContentLoaded',function(){document.removeEventListener('DOMContentLoaded',arguments.callee,false);callback()},false)}else if(document.attachEvent){document.attachEvent('onreadystatechange',function(){if(document.readyState=="complete"){document.detachEvent("onreadystatechange",arguments.callee);callback()}})}else if(document.lastChild==document.body){callback()}};document.ready(function(){if(window.performance){setTimeout(function(){if(hasSendLoad){return}performanceLog();hasSendOther=true},3000)}else{send('window.performance undefined','error')}});